{
    "$schema": "https://docs.renovatebot.com/renovate-schema.json",

    // https://docs.renovatebot.com/presets-config/#configrecommended
    "extends": ["config:recommended"],
    // ... except "ignoreModulesAndTests"
    // TODO Why?
    "ignorePresets": [":ignoreModulesAndTests"],

    // Use "dependencies" as a label for all created pull requests.
    "labels": ["dependencies"],

    // Do not update the build project.
    // NUKE sometimes change API break without a major version.
    // Let's update manually.
    "ignorePaths": ["Build/**"],

    "packageRules": [
        // Do not update xUnit runner.
        // Versions 3.0.0 and above do not support net47(0) anymore.
        // As long as we want to build for net47 we need to reference a version below V3.
        {
            "matchPackageNames": ["xunit.runner.visualstudio"],
            "allowedVersions": "< 3.0.0"
        },

        // Disable updates of .NET SDK. We want to update that manually only.
        {
            "matchDatasources": ["dotnet-version"],
            "enabled": false
        },

        // Disable major updates of System.Threading.Tasks.Extensions because it is part of the public API.
        {
            "matchPackageNames": ["System.Threading.Tasks.Extensions"],
            "matchFileNames": ["**/AwesomeAssertions/**"],
            "allowedVersions": "< 4.6.0"
        },

        // We are supporting test frameworks in different major versions.
        // They have different test projects in the solution.
        // We need to limit the updates for individual projects.
        // First, we disable the update rule for the affected packages...
        {
            "matchPackageNames": [
                "MSTest.TestAdapter", "MSTest.TestFramework",
                "NUnit", "NUnit3TestAdapter"
            ],
            "enabled": false
        },
        // ... then we enable:
        // - MSTest.* in the MSTestV2.Specs project which tests V2 and V3 (< V4) of MSTest framework
        {
            "matchPackageNames": ["MSTest.TestAdapter","MSTest.TestFramework"],
            "matchFileNames": ["**/MSTestV2.Specs/**"],
            "allowedVersions": "< 4.0.0"
        },
        // - MSTest.* in the MSTestV4.Specs project which tests V4 of MSTest framework
        {
            "matchPackageNames": ["MSTest.TestAdapter", "MSTest.TestFramework"],
            "matchFileNames": ["**/MSTestV4.Specs/**"],
            "allowedVersions": ">= 4.0.0"
        },
        // - NUnit in the NUnit3.Specs project which tests V3 (<V4) of NUnit framework
        {
            "matchPackageNames": ["NUnit"],
            "matchFileNames": ["**/NUnit3.Specs/**"],
            "allowedVersions": "< 4.0.0"
        },
        // - NUnit in the NUnit4.Specs project which tests V4 of NUnit framework
        {
            "matchPackageNames": ["NUnit"],
            "matchFileNames": ["**/NUnit4.Specs/**"],
            "allowedVersions": ">= 4.0.0"
        },
        // - NUnit3TestAdapter in the NUnit3.Specs project limited to < V6 because of removals of net6 support
        // TODO Remove these rules once net6 is removed.
        {
            "matchPackageNames": ["NUnit3TestAdapter"],
            "matchFileNames": ["**/NUnit3.Specs/**"],
            "allowedVersions": "< 6.0.0"
        },
        // - NUnit3TestAdapter in the NUnit4.Specs project which tests V4 of NUnit framework
        {
            "matchPackageNames": ["NUnit3TestAdapter"],
            "matchFileNames": ["**/NUnit4.Specs/**"]
        },

        // Disable updates for pinned packages.
        // https://github.com/renovatebot/renovate/blob/main/lib/modules/manager/nuget/readme.md#disabling-updates-for-pinned-versions
        {
            "matchManagers": ["nuget"],
            "matchCurrentValue": "/^\\[[^,]+\\]$/",
            "enabled": false
        },

        // We want to have package updates only once per week, on monday afternoon.
        {
            "matchPackageNames": ["*"],
            "schedule": ["after 4pm on monday"]
        }
    ]
}
